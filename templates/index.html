<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üîí Secure MQTT Web App</title>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
  body { font-family: "Segoe UI", sans-serif; background: #121212; color: #eee; text-align:center; }
  h1 { color:#00e676; }
  .box { background:#1e1e1e; margin:20px auto; padding:20px; width:500px; border-radius:12px; box-shadow:0 0 10px #00e67644; }
  button { background:#00e676; border:none; padding:10px 15px; border-radius:6px; cursor:pointer; color:#000; font-weight:bold; }
  button:hover { background:#00c853; }
  #log { background:#000; padding:10px; text-align:left; height:250px; overflow:auto; font-family:monospace; border-radius:8px; }
  label, select, input { display:block; margin:8px auto; padding:5px; width:80%; border-radius:6px; border:none; }
</style>
</head>
<body>
<h1>üîí Secure MQTT Web App (TLS + Certs)</h1>

<div class="box">
  <h3>1Ô∏è‚É£ Generate Certificates</h3>
  <button onclick="generateCerts()">Generate Certificates</button>
  <p id="genResult"></p>
</div>

<div class="box">
  <h3>2Ô∏è‚É£ Start MQTT Client</h3>
  <label>Mode:</label>
  <select id="mode">
    <option value="pub">Publisher</option>
    <option value="sub">Subscriber</option>
  </select>
  <label>Client ID:</label>
  <input id="client" value="client1">
  <label>Topic:</label>
  <input id="topic" value="/vit/test">
  <label>Payload:</label>
  <input id="payload" value="Hello MQTT!">
  <label><input type="checkbox" id="secure"> Use TLS (Encrypted)</label>
  <button onclick="startClient()">Start Client</button>
</div>

<div class="box">
  <h3>üìú Live MQTT Logs</h3>
  <div id="log"></div>
</div>

<script>
const socket = io();
socket.on("mqtt_log", data => {
  const log = document.getElementById("log");
  log.innerHTML += data.log + "<br>";
  log.scrollTop = log.scrollHeight;
});

function generateCerts() {
  fetch("/generate", { method: "POST" })
  .then(r => r.json())
  .then(d => document.getElementById("genResult").innerText = d.output);
}

function startClient() {
  const data = {
    mode: document.getElementById("mode").value,
    client: document.getElementById("client").value,
    topic: document.getElementById("topic").value,
    payload: document.getElementById("payload").value,
    secure: document.getElementById("secure").checked
  };
  fetch("/start_client", { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify(data) })
  .then(r => r.json())
  .then(d => {
    document.getElementById("log").innerHTML += `‚ñ∂Ô∏è Started ${data.mode} ‚Üí ${JSON.stringify(d)}<br>`;
  });
}
</script>
</body>
</html>
